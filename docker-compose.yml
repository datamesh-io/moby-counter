version: '3'

volumes:
  moby_counter.clicks-db:
    driver: dm
  moby_counter.users-db:
    driver: dm
  moby_counter.uploads:
    driver: dm

services:
  web:
    build: .
    ports:
      - "8100:80"
    links:
      - "redis:redis"
    volumes:
      - ./client:/srv/app/client
  redis:
    image: redis
    volumes:
     - "moby_counter.clicks-db:/data"

  users:
    build: users/
    ports:
      - "8101:8000"
    # TODO: uploads should be stored in a separate uploads service, not bundled
    # together in the users service. divide up the monolith!
    volumes:
     - "moby_counter.uploads:/uploads"
    environment:
     - IMAGE_STORE=/uploads
  users-db:
    image: postgres:9.6.6
    volumes:
     - "moby_counter.users-db:/var/lib/postgresql/data"
